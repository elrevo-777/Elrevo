<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin Dashboard</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
    th { background: #f4f4f4; }
    .new { color: green; font-weight: bold; }
    .read { color: gray; }
    button { padding: 6px 10px; cursor: pointer; }
  </style>
</head>
<body>

<h2>Messages Dashboard</h2>
<button id="logout">Logout</button>

<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Email</th>
      <th>Subject</th>
      <th>Message</th>
      <th>Status</th>
      <th>Date</th>
    </tr>
  </thead>
  <tbody id="messages"></tbody>
</table>
  <!-- MESSAGE MODAL -->
<div id="messageModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6);">
  <div style="background:#fff; max-width:600px; margin:10% auto; padding:20px; border-radius:8px; position:relative;">
    
    <button id="closeModal" style="position:absolute; top:10px; right:10px;">X</button>

    <h3 id="mSubject"></h3>
    <p><b>Name:</b> <span id="mName"></span></p>
    <p><b>Email:</b> <span id="mEmail"></span></p>
    <p><b>Message:</b></p>
    <p id="mMessage"></p>
    <p id="mDate" style="font-size:12px;color:gray;"></p>

  </div>
</div>
  

<script type="module">
  const modal = document.getElementById("messageModal");

function openModal(data) {
  document.getElementById("mName").innerText = data.name || "";
  document.getElementById("mEmail").innerText = data.email || "";
  document.getElementById("mSubject").innerText = data.subject || "";
  document.getElementById("mMessage").innerText = data.message || "";
  document.getElementById("mDate").innerText =
    data.createdAt?.toDate().toLocaleString() || "";

  modal.style.display = "block";
}

document.getElementById("closeModal").onclick = () => {
  modal.style.display = "none";
};

modal.addEventListener("click", (e) => {
  if (e.target === modal) modal.style.display = "none";
});
  
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from
  "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { 
  getFirestore, 
  collection, 
  getDocs, 
  query, 
  orderBy,
  doc,
  updateDoc
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";


// ðŸ”¥ SAME CONFIG (jo tumne CDN se liya)
const firebaseConfig = {
    apiKey: "AIzaSyA4t8qqUiO7KqgeRNKQlMINmKum1if9sFM",
    authDomain: "elegant-revolution.firebaseapp.com",
    projectId: "elegant-revolution",
    storageBucket: "elegant-revolution.firebasestorage.app",
    messagingSenderId: "775296660246",
    appId: "1:775296660246:web:d24fdc77e6dd7c227c1637",
    measurementId: "G-Q6BNJ57JB6"
  };

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// ðŸ”’ PAGE PROTECTION
onAuthStateChanged(auth, (user) => {
  if (!user) {
    window.location.href = "admin.html";
  } else {
    loadMessages();
  }
});

// ðŸ“¥ LOAD MESSAGES
async function loadMessages() {
  const tbody = document.getElementById("messages");
  tbody.innerHTML = "";

  const q = query(
    collection(db, "contacts"),
    orderBy("createdAt", "desc")
  );

  const snapshot = await getDocs(q);

  snapshot.forEach(docSnap => {
  const d = docSnap.data();
  const tr = document.createElement("tr");

  tr.style.cursor = "pointer";

  tr.innerHTML = `
    <td>${d.name || ""}</td>
    <td>${d.email || ""}</td>
    <td>${d.subject || ""}</td>
    <td>${d.message || ""}</td>
    <td class="${d.status === 'new' ? 'new' : 'read'}">
      ${d.status || ""}
    </td>
    <td>${d.createdAt?.toDate().toLocaleString() || ""}</td>
  `;

  // ðŸ‘‡ CLICK = MARK AS READ
  tr.addEventListener("click", async () => {

  // 1ï¸âƒ£ Modal open
  openModal(d);

  // 2ï¸âƒ£ Mark as read
  if (d.status !== "read") {
    await updateDoc(
      doc(db, "contacts", docSnap.id),
      { status: "read" }
    );
    loadMessages();
  }
});


  tbody.appendChild(tr);
});

}

// ðŸšª LOGOUT
document.getElementById("logout").addEventListener("click", async () => {
  await signOut(auth);
  window.location.href = "admin.html";
});
</script>

</body>
</html>
